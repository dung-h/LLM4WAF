# Báo cáo thí nghiệm RED Team - Chu trình v19

- **Ngày:** 2025-11-24
- **Phiên bản:** v19
- **Mục tiêu:** Hoàn thành một chu trình đầy đủ (build dataset, SFT, test, attack) để cải thiện model Gemma-2 2B.

---

## 1. Thông tin Dataset

Dataset `red_v19_unified_mysql_xss.jsonl` được tạo bằng cách hợp nhất các nguồn sau:

- **Backbone:** `red_v18_unified_mysql_xss.jsonl` - **966** bản ghi.
- **Reasoning Subset:** `red_v19_reasoning_subset.jsonl` (tạo mới bằng DeepSeek) - **124** bản ghi mới.
- **Attack Log:** `logs/attack_pipeline.jsonl` - **0** bản ghi mới.
- **Extra Seeds:** `seeds_extra_good.jsonl` - **459** bản ghi mới.

**Tổng cộng:** **1549** bản ghi duy nhất đã được ghi vào dataset `v19` cuối cùng.

Đặc biệt, script đã được nâng cấp để tự động tạo trường `chosen` cho các seed thô, khắc phục lỗi data pipeline từ các chu trình trước.

---

## 2. Cấu hình và kết quả Training

- **Config file:** `configs/sft_gemma2_2b_red_v19_smoke.yaml`
- **Model được SFT:** `google/gemma-2-2b-it`
- **Thời gian training:** ~77 phút (4658 giây)
- **Final train_loss:** `0.6345`

Quá trình training đã diễn ra thành công sau khi khắc phục các vấn đề về dữ liệu.

---

## 3. Intrinsic Testing (Kiểm tra nội bộ)

Model `v19` đã cho thấy khả năng tạo payload tốt trong các bài test mẫu:

- **Điểm mạnh:**
  - Tạo ra các payload SQLi đúng cú pháp và ngữ nghĩa.
  - Thể hiện sự sáng tạo trong việc tạo payload XSS phức tạp, có khả năng lẩn tránh bộ lọc. Ví dụ: `?q=jaVasCript:/*-/*`/*\'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0D%0A`
- **Điểm yếu:**
  - Đôi khi vẫn tạo ra các payload chưa hoàn chỉnh hoặc sai lệch nhỏ về mặt logic.
  - Vẫn còn trường hợp trả về output dạng hội thoại thay vì payload.

---

## 4. DVWA Attack Pipeline Evaluation (Đánh giá trên môi trường thực tế)

- **Script:** `run_attack_pipeline.py` đã được cập nhật để sử dụng adapter `experiments/gemma2_2b_sft_red_v19_smoke`.
- **Kết quả:**
  - Script đã chạy 3 vòng tấn công.
  - Model đã tạo ra nhiều payload, một số là các payload SQLi phức tạp.
  - Đa số các payload tấn công đã bị WAF chặn (`BLOCKED`).
  - **THÀNH CÔNG QUAN TRỌNG:** Ít nhất một payload đã vượt qua WAF (`PASSED`) ở vòng 2, cho thấy sự cải thiện của model:
    ```sql
    ' OR (SELECT CASE WHEN(1=1) THEN CONCAT(0x7e,FLOOR(RAND(0)*2)) ELSE '1' END) = '1
    ```
  - Vẫn còn một số nhiễu (noise) khi model tạo ra các câu trả lời dạng văn bản thay vì payload.

---

## 5. Phân tích & Hướng đi tiếp theo

- **Phân tích:**
  - Model `v19` đã học được cách tạo ra các payload phức tạp và có khả năng bypass WAF cơ bản, đây là một bước tiến so với các phiên bản trước.
  - Việc thêm dữ liệu từ `seeds_extra_good.jsonl` và `reasoning_subset` đã chứng tỏ hiệu quả.
  - Điểm yếu cần cải thiện là tính tuân thủ (đôi khi không tạo payload) và độ chính xác của các payload phức tạp hơn.

- **Đề xuất cho chu trình v20:**
  1.  **Làm giàu Dataset:** Lấy các payload đã bypass thành công và các payload phức tạp bị chặn từ `logs/attack_pipeline.jsonl` của chu trình `v19` để làm seed cho bước "DeepSeek reasoning" tiếp theo.
  2.  **Tinh chỉnh Prompt:** Cân nhắc việc làm rõ hơn prompt cho model trong `run_attack_pipeline.py` để giảm thiểu việc tạo ra các câu trả lời hội thoại.
  3.  Tiếp tục chu trình với phiên bản `v20`.
